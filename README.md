# SDLS - Summary of Changes in Light Scattering Simulation (DLS package)
[ The text below comes from Appendix to Jethva et al., "Ground-based MFRSR UV-Vis spectral retrievals of Saharan dust absorption at Izaña Observatory", Egusphere 2025, 4890, doi: https://doi.org/10.5194/egusphere-2025-4890 ]

Here, we summarize the simplifications implemented in the streamlined, swift DLS reader/interpolator (SDLS). DLS (Dubovik et al., 2006: https://doi.org/10.1029/2005JD006619) is FORTRAN code that calculates radiative parameters (extinction and absorption coefficients, and the phase matrix) for light scattering by a group of randomly oriented spheroids, based on their optical (real n and imaginary k parts of the refractive index) and geometric (size r and aspect ratio ε distributions, D(r) and D(ε), respectively) parameters, and the particle concentration.

To expedite calculations, DLS utilizes two types of look-up tables (LUTs), also called kernels. First are “main” kernels K of size ~5 GB defined on specific grids of all the mentioned parameters. The fixed kernels k_fix are pre-computed from the respective main K-s at a given aspect ratio distribution D(ε). The LUT approach accelerates the calculation of the radiative parameters from the fixed kernels k_fix using, as input, a user-defined (bimodal) size distribution function, particle concentration, and wavelength λ. DLS defines the kernels K and k_fix for a fixed λ = 0.340 μm because the mentioned radiative parameters depend on the size parameter x = 2πr/λ.

However, the implementation of the kernel-based approach in the original DLS package was found to be computationally inefficient and time consuming given the 1-minute intervals of a multi-year UV- and Vis- Multifilter Rotating Shadowband Radiometer (MFRSR) observational record (for details, see the abovemention paper by Jethva et al.). Both K and k_fix are stored in ASCII (text) format, with arrays of different sizes and shape located in the same file. For instance, the phase matrix as a function of scattering angle is provided for subsequent calculations while the r-grid is stored just for reference. Iterative reading of this data format is time-consuming, and the corresponding reader is not laconic.

Next, DLS relies on a computationally expensive cubic spline for interpolating the fixed kernels k_fix from the given r-grid to the user-defined grid r0. However, the spline functionality is used inefficiently; its coefficients are calculated inside the loop over r0, despite they do not depend on it. This has been noted by other users before us. Furthermore, DLS calls the spline over r for two points of the n-grid interval that contains the user’s value n0 (same for the imaginary part k – 4 calls total). Then, bilinear interpolation is used to get the output at the user’s n0 and k0. By switching the sequence of the interpolations – first bilinear over the refractive index, then spline over the size – the number of spline calls is reduced from 4 to 1. Even that single spline call can be eliminated since we integrate over the size, making interpolation between size grids unnecessary. Note that instead of the lognormal size distribution D(ln(r)), it is more natural to use the size parameter distribution D(ln(x)) for integration over particle size.

To overcome the noted inefficiencies, we have implemented the following changes to the DLS package for deriving an equivalent but much faster and efficient SDLS tool for reading and interpolating the fixed kernels generated by the original DLS package.

1. A few subroutines of the original DLS FORTRAN code responsible for reading and interpolating the fixed kernels were manually translated to C/C++, as this work was initiated as part of translation of MAIAC’s (Lyapustin et al., 2021: https://doi.org/10.3389/frsen.2021.645794) polarized radiative transfer solver IPOL (Korkin and Lyapustin, 2023: https://doi.org/10.1016/j.jqsrt.2023.108663) from FORTRAN into C.
2. We now store k_fix in binary files; auxiliary parameters like grids of scattering angles and particle size are hardcoded. As a result, reading k_fix requires just a single command in C.
3. All splines were dropped from the code, and we adopted integration in the ln(x) space using the same x-grid as in the fixed kernel k_fix; the same applies to the scattering angle – we use the grid from the fixed kernels, 0° to 180° in steps of 1°.
4. The DLS code is split into two parts with refactoring applied to only the part utilizing the fixed kernels k_fix because it is being called iteratively in retrieval algorithms. Hence, its high efficiency is crucial, especially for the hyperspectral measurements. We have not changed the part of DLS that calculates k_fix from K; nor have we updated the “main” LUTs. However, we note that keeping the component calculating radiative single scattering properties (called in real time) and the one calculating k_fix from K within a single code is impractical.

In summary, SDLS software performs 3 steps: (a) reads the fixed kernels k_fix from 7 binary files (six for the elements of the phase matrix, one for the scattering and extinction coefficients combined); (b) performs bilinear interpolation over the real and imaginary parts of the refractive index for the user-provided values; (c) integrates over the size parameter. The refactored package has been tested and is now available from this GitHub repository with documentation. A stand-alone code converiting the fixed kernels from the legacy ASCII format to the new binary one is also provided under ./convert_kernels_src_linux/.

Our improvements are relevant to the software. We added nothing to the scientific aspects described in Dubovik et al. (2006), https://doi.org/10.1029/2005JD006619. We are aware that the GRASP Team (https://www.grasp-open.com/) has also improved the DLS package: https://code.grasp-open.com/open/spheroid-package/ (simple registration is required). However, we have not evaluated their implementation yet because results of their and our efforts were released simultaneously, about 3 years ago. Instead, we worked with a version provided to us by the original developers, which has served our in-house community, with occasional updates, for about 2 decades and tailored that stable version of DLS package to our specific needs.

-EOF-
